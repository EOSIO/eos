<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>EOS.IO: contracts/exchange/exchange.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="eos-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EOS.IO
   &#160;<span id="projectnumber">DAWN1.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ae9b15dd87e066e1908bbd90e8f38627.html">contracts</a></li><li class="navelem"><a class="el" href="dir_5dc13a1abd435123f7be5ea8dc751d1b.html">exchange</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">exchange.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>defines an example exchange contract  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="exchange_8hpp_source.html">exchange/exchange.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="print_8hpp_source.html">eoslib/print.hpp</a>&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for exchange.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="exchange_8cpp__incl.png" border="0" usemap="#contracts_2exchange_2exchange_8cpp" alt=""/></div>
<map name="contracts_2exchange_2exchange_8cpp" id="contracts_2exchange_2exchange_8cpp">
<area shape="rect" id="node2" href="exchange_8hpp.html" title="exchange/exchange.hpp" alt="" coords="153,95,316,121"/>
<area shape="rect" id="node10" href="print_8hpp.html" title="eoslib/print.hpp" alt="" coords="135,393,246,420"/>
<area shape="rect" id="node3" href="currency_8hpp.html" title="currency/currency.hpp" alt="" coords="258,169,409,196"/>
<area shape="rect" id="node4" href="eos_8hpp.html" title="eoslib/eos.hpp" alt="" coords="199,244,305,271"/>
<area shape="rect" id="node16" href="token_8hpp.html" title="Defines types and ABI for standard token messages and database tables. " alt="" coords="528,319,645,345"/>
<area shape="rect" id="node17" href="db_8hpp.html" title="eoslib/db.hpp" alt="" coords="596,244,695,271"/>
<area shape="rect" id="node5" href="types_8hpp.html" title="eoslib/types.hpp" alt="" coords="5,468,123,495"/>
<area shape="rect" id="node7" href="message_8hpp.html" title="eoslib/message.hpp" alt="" coords="315,319,453,345"/>
<area shape="rect" id="node12" href="math_8hpp.html" title="eoslib/math.hpp" alt="" coords="453,468,568,495"/>
<area shape="rect" id="node14" href="transaction_8hpp.html" title="eoslib/transaction.hpp" alt="" coords="141,319,291,345"/>
<area shape="rect" id="node6" href="types_8h.html" title="eoslib/types.h" alt="" coords="307,692,410,719"/>
<area shape="rect" id="node8" href="message_8h.html" title="eoslib/message.h" alt="" coords="322,543,446,569"/>
<area shape="rect" id="node9" href="system_8h.html" title="eoslib/system.h" alt="" coords="376,617,491,644"/>
<area shape="rect" id="node11" href="print_8h.html" title="eoslib/print.h" alt="" coords="147,468,243,495"/>
<area shape="rect" id="node13" href="math_8h.html" title="eoslib/math.h" alt="" coords="470,543,570,569"/>
<area shape="rect" id="node15" href="transaction_8h.html" title="eoslib/transaction.h" alt="" coords="217,617,351,644"/>
<area shape="rect" id="node18" href="db_8h.html" title="Defines C API for interfacing with blockchain database. " alt="" coords="620,393,705,420"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespaceexchange"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceexchange.html">exchange</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa79eb8bb393de1f4f3c2f40002340a4a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceexchange.html#aa79eb8bb393de1f4f3c2f40002340a4a">exchange::save</a> (const <a class="el" href="struct_account.html">Account</a> &amp;a)</td></tr>
<tr class="separator:aa79eb8bb393de1f4f3c2f40002340a4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbb79e5408239e3a7c12a2c79b69db62"><td class="memTemplParams" colspan="2">template&lt;typename Lambda &gt; </td></tr>
<tr class="memitem:abbb79e5408239e3a7c12a2c79b69db62"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespaceexchange.html#abbb79e5408239e3a7c12a2c79b69db62">exchange::modifyAccount</a> (<a class="el" href="group__types.html#gad67b43dc23285b01176f4c181c59fc23">AccountName</a> a, Lambda &amp;&amp;modify)</td></tr>
<tr class="separator:abbb79e5408239e3a7c12a2c79b69db62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d1831d86ebf1c90cc808e7dbab7b33d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceexchange.html#a7d1831d86ebf1c90cc808e7dbab7b33d">exchange::apply_currency_transfer</a> (const currency::Transfer &amp;transfer)</td></tr>
<tr class="separator:a7d1831d86ebf1c90cc808e7dbab7b33d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cd292ab951651316cbdaab066d73f22"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceexchange.html#a7cd292ab951651316cbdaab066d73f22">exchange::apply_eos_transfer</a> (const <a class="el" href="structeos_1_1_transfer.html">eosio::Transfer</a> &amp;transfer)</td></tr>
<tr class="separator:a7cd292ab951651316cbdaab066d73f22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeef884b3f23cf9d6bbf03e46550a3756"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceexchange.html#aeef884b3f23cf9d6bbf03e46550a3756">exchange::match</a> (Bid &amp;bid, <a class="el" href="struct_account.html">Account</a> &amp;buyer, Ask &amp;ask, <a class="el" href="struct_account.html">Account</a> &amp;seller)</td></tr>
<tr class="separator:aeef884b3f23cf9d6bbf03e46550a3756"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a144bb14807f5677faf9d569813f9294e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceexchange.html#a144bb14807f5677faf9d569813f9294e">exchange::apply_exchange_buy</a> (<a class="el" href="structexchange_1_1_buy_order.html">BuyOrder</a> order)</td></tr>
<tr class="separator:a144bb14807f5677faf9d569813f9294e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab470301ace28436a6fee53e27cd33f8f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceexchange.html#ab470301ace28436a6fee53e27cd33f8f">exchange::apply_exchange_sell</a> (<a class="el" href="structexchange_1_1_sell_order.html">SellOrder</a> order)</td></tr>
<tr class="separator:ab470301ace28436a6fee53e27cd33f8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c2d3b49abb85b4595515398851ab03b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceexchange.html#a0c2d3b49abb85b4595515398851ab03b">exchange::apply_exchange_cancel_buy</a> (<a class="el" href="structexchange_1_1_order_i_d.html">OrderID</a> order)</td></tr>
<tr class="separator:a0c2d3b49abb85b4595515398851ab03b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a199b823910407b578e3e313dac5f24"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceexchange.html#a4a199b823910407b578e3e313dac5f24">exchange::apply_exchange_cancel_sell</a> (<a class="el" href="structexchange_1_1_order_i_d.html">OrderID</a> order)</td></tr>
<tr class="separator:a4a199b823910407b578e3e313dac5f24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02fd73d861ef2e4aabb38c0c9ff82947"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exchange_8cpp.html#a02fd73d861ef2e4aabb38c0c9ff82947">init</a> ()</td></tr>
<tr class="separator:a02fd73d861ef2e4aabb38c0c9ff82947"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c01edc4ed313916967237c16feb1446"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exchange_8cpp.html#a3c01edc4ed313916967237c16feb1446">apply</a> (<a class="el" href="group__types.html#gaaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> code, <a class="el" href="group__types.html#gaaa5d1cd013383c889537491c3cfd9aad">uint64_t</a> action)</td></tr>
<tr class="separator:a3c01edc4ed313916967237c16feb1446"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><dl class="section copyright"><dt>Copyright</dt><dd>defined in eos/LICENSE.txt This exchange contract assumes the existence of two currency contracts located at  and . These currency contracts have provided an API header defined in <a class="el" href="currency_8hpp.html">currency.hpp</a> which the exchange contract will use to process messages related to deposits and withdraws.</dd></dl>
<p>The exchange contract knows that the currency contracts <a class="el" href="group__messagecapi.html#gaeb32e8229c58b2b2b045080dc1d4b850" title="Add the specified account to set of accounts to be notified. ">requireNotice()</a> of both the sender and receiver; therefore, the exchange contract can implement a message handler that will be called anytime funds are deposited to or withdrawn from the exchange.</p>
<p>When tokens are sent to  from another account the exchange will credit the user's balance of the proper currency.</p>
<p>To withdraw from the exchange, the user simply reverses the "to" and "from" fields of the currency contract transfer message. The currency contract will require the "authority" of the exchange, but the exchange's <a class="el" href="exchange_8cpp.html#a02fd73d861ef2e4aabb38c0c9ff82947">init()</a> function configured this permission to allow <em>anyone</em> to transfer from the exchange.</p>
<p>To prevent people from stealing all the money from the exchange, the exchange's transfer handler requires both the authority of the receiver and asserts that the user has a sufficient balance on the exchange. Lacking both of these the exchange will kill the transfer.</p>
<p>The exchange and one of the currency contracts are forced to execute in the same thread anytime there is a deposit or withdraw. The transaction containing the transfer are already required to include the exchange in the scope by the currency contract.</p>
<p>creating, canceling, and filling orders do not require blocking either currency contract. Users can only deposit or withdraw to their own currency account. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a3c01edc4ed313916967237c16feb1446"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__types.html#gaaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td>
          <td class="paramname"><em>code</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__types.html#gaaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>&#160;</td>
          <td class="paramname"><em>action</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The apply method implements the dispatch of events to this contract </p>

</div>
</div>
<a class="anchor" id="a02fd73d861ef2e4aabb38c0c9ff82947"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
